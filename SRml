[General]
bypass-system = true
skip-proxy = 10.0.0.0/8, 172.16.0.0/12, localhost, *.local, e.crashlytics.com, captive.apple.com, sequoia.apple.com, seed-sequoia.siri.apple.com, *.ls.apple.com
tun-excluded-routes = 10.0.0.0/8, 100.64.0.0/10, 127.0.0.0/8, 169.254.0.0/16, 172.16.0.0/12, 192.0.0.0/24, 192.0.2.0/24, 192.88.99.0/24, 192.168.0.0/16, 198.18.0.0/15, 198.51.100.0/24, 203.0.113.0/24, 224.0.0.0/4, 255.255.255.255/32
# 对应 clash-meta 的 DNS 配置，优先使用国外 DoH/DoT
dns-server = tls://223.5.5.5,https://1.1.1.1/dns-query,tls://1.1.1.1
# 国内 DNS 作为后备
fallback-dns-server = 223.5.5.5, 119.29.29.29, 1.12.12.12
# 启用 IPv6 以匹配 clash-meta
ipv6 = true
prefer-ipv6 = false
dns-direct-system = false
dns-direct-fallback-proxy = true
icmp-auto-reply = true
always-reject-url-rewrite = false
private-ip-answer = true
udp-policy-not-supported-behaviour = DIRECT

[Rule]
# 特定网段直接代理（对应 clash-meta 中的 IP-CIDR,192.168.31.0/24）
IP-CIDR,192.168.31.0/24,PROXY

# Private/LAN 地址直连（对应 clash-meta 的 private 和 lancidr 规则集）
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/Lan/Lan.list,DIRECT

# Reject 广告规则（对应 clash-meta 的 reject 规则集）
RULE-SET,https://raw.githubusercontent.com/Loyalsoldier/surge-rules/release/reject.txt,REJECT
RULE-SET,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/BanAD.list,REJECT

# Apple Push 服务直连（对应 clash-meta 的特定规则）
DOMAIN-SUFFIX,push.apple.com,DIRECT

# 需要代理的服务（对应 clash-meta 的 proxy 规则集）
# GitHub
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/GitHub/GitHub.list,PROXY,force-remote-dns
# Telegram
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/Telegram/Telegram.list,PROXY,force-remote-dns
# Google服务
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/Google/Google.list,PROXY,force-remote-dns
# YouTube
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/YouTube/YouTube.list,PROXY,force-remote-dns
# Netflix
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/Netflix/Netflix.list,PROXY,force-remote-dns
# Twitter
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/Twitter/Twitter.list,PROXY,force-remote-dns
# Facebook
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/Facebook/Facebook.list,PROXY,force-remote-dns
# Microsoft
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/Microsoft/Microsoft.list,PROXY,force-remote-dns
# Apple国际服务
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/AppleProxy/AppleProxy.list,PROXY,force-remote-dns
# 其他常见国外服务
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/ProxyMedia/ProxyMedia.list,PROXY,force-remote-dns
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/ProxyGFWlist/ProxyGFWlist.list,PROXY,force-remote-dns

# 国内服务直连（对应 clash-meta 的 direct 和 cn 规则集）
# Apple 国内服务
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/Apple/Apple.list,DIRECT
# 微信
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/WeChat/WeChat.list,DIRECT
# 哔哩哔哩
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/BiliBili/BiliBili.list,DIRECT
# 微博
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/Weibo/Weibo.list,DIRECT
# 支付宝
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/Alipay/Alipay.list,DIRECT
# 中国大陆网站和服务
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/China/China.list,DIRECT
DOMAIN-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/China/China_Domain.list,DIRECT

# 中国 IP 段直连（对应 clash-meta 的 cncidr 规则集）
GEOIP,CN,DIRECT

# 兜底规则：其他流量走代理（对应 clash-meta 的 MATCH 规则）
FINAL,PROXY

[Host]
localhost = 127.0.0.1
# 过滤一些可能影响 fake-ip 的域名（对应 clash-meta 的 fake-ip-filter）
*.g999.ru = reject
*.666888.de = reject

[URL Rewrite]
^https?:\/\/(www.)?(g|google)\.(cn|com\.hk) https://www.google.com 302

[MITM]
hostname = *.google.cn,*.google.com.hk
